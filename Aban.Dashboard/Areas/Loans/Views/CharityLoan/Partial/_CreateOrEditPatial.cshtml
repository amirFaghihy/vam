@model CharityLoan
@using Aban.Common

<div class="col-xl-12 col-lg-12 col-md-12 layout-spacing">
    <div class="info">
        <div class="row">
            <div class="col-md-11 mx-auto">
                <div class="row">

                    <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
                        <div class="col-md-12" style="float: right !important; margin-bottom: 15px;">
                            <div class="text-right">
                                <a style="cursor:pointer" class="btn btn-success mb-2 pr-5 pl-5" onclick="DirectSave(this)">ذخیره</a>
                                <a class="btn btn-danger mb-2 btn-showloader" href="/Loans/CharityLoan/Index">انصراف</a>
                            </div>
                        </div>
                        <br />
                        <br />
                    </div>

                    <input type="hidden" asp-for="Id" />
                    <input type="hidden" asp-for="IsDelete" />

                    <div class="col-sm-6 col-md-6 col-lg-6 col-xl-6">
                        <div class="form-group">
                            <label asp-for="LoanReceiverId"></label>
                            <select asp-for="LoanReceiverId" asp-items="ViewBag.listLoanReceiver" class="form-control basic-select">
                                <option value="">-- انتخاب --</option>
                            </select>
                            <span asp-validation-for="LoanReceiverId" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="col-sm-6 col-md-6 col-lg-6 col-xl-6">
                        <div class="form-group">
                            <label asp-for="GuaranteeId"></label>
                            <select asp-for="GuaranteeId" asp-items="ViewBag.listGuarantee" class="form-control basic-select">
                                <option value="">-- انتخاب --</option>
                            </select>
                            <span asp-validation-for="GuaranteeId" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="col-sm-6 col-md-6 col-lg-6 col-xl-6">
                        <div class="form-group">
                            <label asp-for="LoanAmount"></label>
                            <input asp-for="LoanAmount" type="text" class="form-control" onkeyup="formatNumber(this.id, this.value)" value="@Model.LoanAmount.ToString("N0")" onclick="select()">
                            <span asp-validation-for="LoanAmount" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="col-sm-6 col-md-6 col-lg-6 col-xl-6">
                        <div class="form-group">
                            <label asp-for="PercentSalary"></label>
                            <input asp-for="PercentSalary" type="text" class="form-control">
                            <span asp-validation-for="PercentSalary" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="col-sm-6 col-md-6 col-lg-6 col-xl-6">
                        <div class="form-group">
                            <label asp-for="AccountNumber"></label>
                            <input asp-for="AccountNumber" type="text" class="form-control">
                            <span asp-validation-for="AccountNumber" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
                        <div class="form-group">
                            <label asp-for="Description"></label>
                            <textarea asp-for="Description" class="form-control"></textarea>
                            <span asp-validation-for="Description" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="col-sm-6 col-md-6 col-lg-6 col-xl-6">
                        <div class="form-group">
                            <label asp-for="PaymentStartDate"></label>
                            @{
                                var dateValue = (Model.PaymentStartDate != default ? Html.ConvertToPersianDate(Model.PaymentStartDate) : Html.ConvertToPersianDate(DateTime.Now));
                            }
                            <input id="paymentStartDateString" name="paymentStartDateString" type="text" 
                                   class="form-control mb-4 PersianDatePicker" 
                                   value="@dateValue" 
                                   autocomplete="off" 
                                   readonly 
                                   style="background-color: white; cursor: pointer;" />
                            <span asp-validation-for="PaymentStartDate" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="form-group">
                            <label asp-for="NumberOfInstallments"></label>
                            <input asp-for="NumberOfInstallments" type="text" class="form-control" onclick="select()">
                            <span asp-validation-for="NumberOfInstallments" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="form-group">
                            <label asp-for="IsDone"></label>
                            <div class="form-group mt-30">
                                <label class="switch s-icons s-outline s-outline-primary mb-4 mr-2">
                                    <input type="checkbox" asp-for="IsDone">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<div class="col-md-12" style="float: left !important; margin-bottom: 15px;">
    <div class="text-left">
        <a style="cursor:pointer" class="btn btn-success mb-2 pr-5 pl-5" onclick="DirectSave(this)">ذخیره</a>
        <a class="btn btn-danger mb-2 btn-showloader" href="/Loans/CharityLoan/Index">انصراف</a>
    </div>
</div>

<script>
    // فعال‌سازی Select2 برای لیست‌ها
    try {
        $(".basic-select").select2({
            tags: true,
            dir: "rtl"
        });
    } catch (e) { console.log("Select2 not loaded", e); }

    function DirectSave(element) {
        var form = $(element).closest('form');

        // اگر فرم معتبر بود، مستقیم ارسال کن
        if (form.valid()) {
            form.submit();
        }
    }
</script>