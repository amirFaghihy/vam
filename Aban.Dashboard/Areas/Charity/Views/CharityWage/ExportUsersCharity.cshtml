@model X.PagedList.IPagedList<CharityWage>


@{
    Layout = "~/Views/Shared/_Layout.cshtml";

    Aban.ViewModel.BreadCrumb breadCrumb = new Aban.ViewModel.BreadCrumb();
    breadCrumb.PageTitle = "خروجی حقوق";
    breadCrumb.Title = "خروجی حقوق";

    breadCrumb.Links = new List<string[]> {
#pragma warning disable CS8601 // Possible null reference assignment.
        new string[2] { Url.Action("Index"), breadCrumb.PageTitle }
#pragma warning disable CS8601 // Possible null reference assignment.
    };

}
@await Html.PartialAsync("~/Views/Shared/Generic/_BreadCrumb.cshtml", breadCrumb)



<div class="row layout-top-spacing">
    <div class="col-lg-12 col-12 layout-spacing">
        <div class="statbox widget box box-shadow">

            <div class="alert alert-danger mb-4" role="alert">
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    ×
                </button>
                <strong>توجه: </strong> با توجه به بازه تاریخی که حقوق محاسبه شده است، تاریخ‌های زیر را انتخاب کنید !
            </div>

            <div class="info">
                <div class="row">
                    <div class="col-md-11 mx-auto">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <lable>از تاریخ</lable>
                                    <input id="startDateString" name="startDateString" class="form-control mb-4 PersianDatePicker" type="text" readonly />
                                    <span class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <lable>تا تاریخ</lable>
                                    <input id="endDateString" name="endDateString" class="form-control mb-4 PersianDatePicker" type="text" readonly />
                                    <span class="text-danger"></span>
                                </div>
                            </div>


                            <div class="col-md-12" style="float: left !important; margin-bottom: 15px;">
                                <div class="text-left">
                                    <button onclick="downloadFile()" class="btn btn-success mb-2 pr-5 pl-5"> تأیید </button>
                                    <a class="btn btn-danger mb-2" href="@Url.Action("Index", "CharityWage")">انصراف</a>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

@section Styles{
    <script>
        function datetime() {

            var now = new Date();
            var year = now.getFullYear();
            var month = (now.getMonth() + 1).toString().padStart(2, '0');
            var day = now.getDate().toString().padStart(2, '0');
            var hours = now.getHours().toString().padStart(2, '0');
            var minutes = now.getMinutes().toString().padStart(2, '0');
            var seconds = now.getSeconds().toString().padStart(2, '0');

            var formattedDateTime = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;

            return formattedDateTime;
        }

        function downloadFile() {

            loadScrean();

            const startDateString = $('#startDateString').val();
            const endDateString = $('#endDateString').val();

            $.ajax({
                url: "@Url.Action("SettExportUsersCharity", "CharityWage", new{area="Charity"})",
                data: { startDateString: startDateString, endDateString: endDateString },
                method: "GET",
                xhrFields: {
                    responseType: "blob"
                },
                success: function (data) {
                    var a = document.createElement("a");
                    var url = window.URL.createObjectURL(data);
                    a.href = url;
                    a.download = datetime() + ".xlsx";
                    document.body.append(a);
                    a.click();
                    window.URL.revokeObjectURL(url);

                    $('#startDateString').val("");
                    $('#endDateString').val("");

                    hideScrean();
                },
                error: function () {
                    hideScrean();
                    alert("خطایی رخ داده است، دوباره تلاش کنید.");
                }
            });
        };


        function loadScrean() {
            $('#form_loader').modal('show');
        }

        function hideScrean() {
            $('#form_loader').modal('hide');
        }
    </script>
    }